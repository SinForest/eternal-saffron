<html>
	<head>
		<title>Memory</title>
		<script>
			var xMax = 4;
			var yMax = 4;
			var openCard = -1;
			var openCard2 = -1;
			var points = 0;
			var trys = 0;
			var lastGuess = false;
		</script>
		<script src=http://testing.thesinforest.eu/jquery.js></script>
		<style>
			#game_tb
				{
				border-style:double;
				border-width:6px;
				border-color:#120a8f;
				border-collapse:collapse;
				}
			.game_td
				{
				border-style:solid;
				border-width:2px;
				border-color:#120a8f;
				text-align:center;
				}
			.dfield
				{
				width:70px;
				height:70px;
				text-algin:center;
				}
		</style>
		<script>
			var cards = Array(); //Ethält die Vorderseite der Karte
			var used = Array();	//Array zur Kontrolle, welche Karte wie oft benutzt wurde
			
			//Initaialisierung der Arrays auf 0; (Bei cards[] überflüssig?)
			for(var i = 0; i<(xMax*yMax); i++)
			{
				cards[i] = 0;
				if (i < (xMax*yMax*0.5)) used[i] = 0;
			}
			
			//Verteilung der Karten. Keine darf öfter als 2 mal vorkommen
			for(var i = 0; i<(xMax*yMax); i++)
			{
				var rnd = 0;
				do
				{
					rnd = Math.floor((xMax*yMax*0.5)*Math.random());
				}
				while(used[rnd] == 2);
				cards[i] = rnd;
				used[rnd]++;
			}
			
			$(document).ready(function(){
				for(var i=0; i<yMax; i++)
				{
					var tmp = "";
					for(var e=0; e<xMax; e++)
					{
						var tmp_id = ((i*xMax)+e);
						tmp += ('<td id="tfield_' + tmp_id + '" class="game_td"><div id="dfield_' + tmp_id + '" class="dfield"><img src="cards/backside.png" width="70px" height="70px" id="ifield_' + tmp_id + '"></img></div></td>');
					}
					$("#game_tb").append('<tr class="gamerow" id="gr' + (i+1) + '">' + tmp +'</tr>');
				}
				
				$(".game_td").click(function(){
					var card_id = $(this).attr("id");
					card_id = card_id.replace("tfield_","");
					if(card_id == openCard) //Die selbe Karte wurde 2 mal angeklickt;
					{
						if(lastGuess)
						{
							$("#ifield_"+openCard).hide();
							$("#ifield_"+openCard2).hide();
							$("#tfield_"+openCard).unbind('click');
							$("#tfield_"+openCard2).unbind('click');
							openCard = -1;
							openCard2 = -1;
							lastGuess = false;
							if(points == (xMax*yMax*0.5))
								alert("Du hast mit "+trys+" Versuchen gewonnen!");
						}
					}
					else if((openCard > -1) && (openCard2 == -1)) //Es ist genau eine Karte aufgedeckt
					{
						//Merke Karte:
							openCard2 = card_id;
						//Zeige Karte:
						$("#ifield_"+card_id).attr("src","cards/"+cards[card_id]+".png");
						//Überprüfe:
						if(cards[card_id] == cards[openCard])
						{
							points++;
							$("#points").html(points);
							lastGuess = true;
						}
						else
						{
							lastGuess = false;
						}
						trys++;
						$("#trys").html(trys);
					}
					else if(openCard == -1) //Es ist noch keine Karte aufgedeckt
					{
						//Zeige Karte:
						$("#ifield_"+card_id).attr("src","cards/"+cards[card_id]+".png");
						//Merke offene Karte:
						openCard = card_id;
					}
					else //Es sind 2 Karten aufgedeckt
					{
						if(lastGuess)
						{
							$("#ifield_"+openCard).hide();
							$("#ifield_"+openCard2).hide();
							$("#tfield_"+openCard).unbind('click');
							$("#tfield_"+openCard2).unbind('click');
							lastGuess = false;
							if(points == (xMax*yMax*0.5))
								alert("Du hast mit "+trys+" Versuchen gewonnen!");
						}
						else
						{
							//Verdecke Karten:
							$("#ifield_"+openCard).attr("src","cards/backside.png");
							$("#ifield_"+openCard2).attr("src","cards/backside.png");
						}
						openCard = -1;
						openCard2 = -1;
					}
				});
			});
		</script>
	</head>
	<body>
		<div id=game_div>
			<table id="game_tb">
				
			</table>
			<p id="scoreboard">
				<strong>Versuche:</strong><span id="trys">0</span> <strong>Punkte:</strong><span id="points">0</span>
			</p>
		</div>
	</body>
</html>